{% extends "base.html" %}

{% block title %}Aviation Calculators{% endblock %}

{% block content %}
<div class="container py-4">
    <h1 class="mb-4">Aviation Calculators</h1>

    <!-- Navigation Tabs -->
    <ul class="nav nav-tabs mb-4" id="aviationTabs" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="fuel-tab" data-bs-toggle="tab" href="#fuel" role="tab">Fuel Calculator</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="density-tab" data-bs-toggle="tab" href="#density" role="tab">Density Altitude</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="ground-speed-tab" data-bs-toggle="tab" href="#ground-speed" role="tab">Ground Speed</a>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="aviationTabContent">
        <!-- Fuel Calculator -->
        <div class="tab-pane fade show active" id="fuel" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Fuel Requirements Calculator</h5>
                    <form id="fuelForm" class="mt-3">
                        <div class="mb-3">
                            <label for="fuelDistance" class="form-label">Distance (NM)</label>
                            <input type="number" class="form-control" id="fuelDistance" required>
                        </div>
                        <div class="mb-3">
                            <label for="fuelIAS" class="form-label">Indicated Airspeed (kts)</label>
                            <input type="number" class="form-control" id="fuelIAS" required>
                        </div>
                        <div class="mb-3">
                            <label for="fuelConsumption" class="form-label">Fuel Consumption (gal/hr)</label>
                            <input type="number" class="form-control" id="fuelConsumption" required>
                        </div>
                        <div class="mb-3">
                            <label for="fuelWindSpeed" class="form-label">Wind Speed (kts)</label>
                            <input type="number" class="form-control" id="fuelWindSpeed" value="0">
                        </div>
                        <div class="mb-3">
                            <label for="fuelWindDirection" class="form-label">Wind Direction (degrees)</label>
                            <input type="number" class="form-control" id="fuelWindDirection" value="0" min="0" max="360">
                        </div>
                        <div class="mb-3">
                            <label for="fuelHeading" class="form-label">Aircraft Heading (degrees)</label>
                            <input type="number" class="form-control" id="fuelHeading" value="0" min="0" max="360">
                        </div>
                        <div class="mb-3">
                            <label for="fuelReserveTime" class="form-label">Reserve Time (min)</label>
                            <input type="number" class="form-control" id="fuelReserveTime" value="45">
                        </div>
                        <button type="submit" class="btn btn-primary">Calculate</button>
                    </form>
                    <div id="fuelResult" class="mt-3"></div>
                </div>
            </div>
        </div>

        <!-- Ground Speed Calculator -->
        <div class="tab-pane fade" id="ground-speed" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Ground Speed Calculator</h5>
                    <form id="windForm" class="mt-3">
                        <div class="mb-3">
                            <label for="gsIAS" class="form-label">Indicated Airspeed (kts)</label>
                            <input type="number" class="form-control" id="gsIAS" required>
                        </div>
                        <div class="mb-3">
                            <label for="gsWindSpeed" class="form-label">Wind Speed (kts)</label>
                            <input type="number" class="form-control" id="gsWindSpeed" required>
                        </div>
                        <div class="mb-3">
                            <label for="gsWindDirection" class="form-label">Wind Direction (degrees)</label>
                            <input type="number" class="form-control" id="gsWindDirection" required min="0" max="360">
                        </div>
                        <div class="mb-3">
                            <label for="gsHeading" class="form-label">Aircraft Heading (degrees)</label>
                            <input type="number" class="form-control" id="gsHeading" required min="0" max="360">
                        </div>
                        <div class="mb-3">
                            <label for="gsTemperature" class="form-label">Temperature (°C)</label>
                            <input type="number" class="form-control" id="gsTemperature" required>
                        </div>
                        <div class="mb-3">
                            <label for="gsPressureAltitude" class="form-label">Pressure Altitude (ft)</label>
                            <input type="number" class="form-control" id="gsPressureAltitude" value="0">
                        </div>
                        <button type="submit" class="btn btn-primary">Calculate</button>
                    </form>
                    <div id="windResult" class="mt-3"></div>
                </div>
            </div>
        </div>

        <!-- Density Altitude Calculator -->
        <div class="tab-pane fade" id="density" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Density Altitude Calculator</h5>
                    <form id="densityForm" class="mt-3">
                        <div class="mb-3">
                            <label for="daPressureAltitude" class="form-label">Pressure Altitude (ft)</label>
                            <input type="number" class="form-control" id="daPressureAltitude" required>
                        </div>
                        <div class="mb-3">
                            <label for="daTemperature" class="form-label">Temperature (°C)</label>
                            <input type="number" class="form-control" id="daTemperature" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Calculate</button>
                    </form>
                    <div id="densityResult" class="mt-3"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('fuelForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            distance: document.getElementById('fuelDistance').value,
            indicatedAirspeed: document.getElementById('fuelIAS').value,
            fuelConsumption: document.getElementById('fuelConsumption').value,
            windSpeed: document.getElementById('fuelWindSpeed').value,
            windDirection: document.getElementById('fuelWindDirection').value,
            heading: document.getElementById('fuelHeading').value,
            reserveTime: document.getElementById('fuelReserveTime').value
        };

        try {
            const response = await fetch('/aviation/api/aviation/fuel-calc', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            if (response.ok) {
                document.getElementById('fuelResult').innerHTML = `
                <div class="alert alert-success">
                    <p>Ground Speed: ${result.ground_speed} knots</p>
                    <p>Flight Time: ${result.flight_time} minutes</p>
                    <p>Total Fuel Required: ${result.fuel_required} gallons</p>
                    <p>Reserve Fuel: ${result.reserve_fuel} gallons</p>
                </div>
            `;
            } else {
                throw new Error(result.error);
            }
        } catch (error) {
            document.getElementById('fuelResult').innerHTML = `
            <div class="alert alert-danger">${error.message}</div>
        `;
        }
    });

    document.getElementById('windForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            indicatedAirspeed: document.getElementById('gsIAS').value,
            windSpeed: document.getElementById('gsWindSpeed').value,
            windDirection: document.getElementById('gsWindDirection').value,
            heading: document.getElementById('gsHeading').value,
            temperature: document.getElementById('gsTemperature').value,
            pressureAltitude: document.getElementById('gsPressureAltitude').value
        };

        try {
            const response = await fetch('/aviation/api/aviation/ground-speed', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            if (response.ok) {
                document.getElementById('windResult').innerHTML = `
                <div class="alert alert-success">
                    <p>Ground Speed: ${result.ground_speed} knots</p>
                    <p>Density Altitude: ${result.density_altitude} feet</p>
                    ${result.headwind_component !== undefined ? `<p>Headwind Component: ${result.headwind_component} kts</p>` : ''}
                    ${result.crosswind_component !== undefined ? `<p>Crosswind Component: ${result.crosswind_component} kts</p>` : ''}
                </div>
            `;
            } else {
                throw new Error(result.error);
            }
        } catch (error) {
            document.getElementById('windResult').innerHTML = `
            <div class="alert alert-danger">${error.message}</div>
        `;
        }
    });

    document.getElementById('densityForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
            pressureAltitude: document.getElementById('daPressureAltitude').value,
            temperature: document.getElementById('daTemperature').value
        };

        try {
            const response = await fetch('/aviation/api/aviation/density-altitude', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            const result = await response.json();
            if (response.ok) {
                document.getElementById('densityResult').innerHTML = `
                <div class="alert alert-success">
                    <p>Density Altitude: ${result.density_altitude} feet</p>
                </div>
            `;
            } else {
                throw new Error(result.error);
            }
        } catch (error) {
            document.getElementById('densityResult').innerHTML = `
            <div class="alert alert-danger">${error.message}</div>
        `;
        }
    });
</script>
{% endblock %}